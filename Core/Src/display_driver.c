/*
 * display_driver.c
 *
 *  Created on: Sep 13, 2020
 *      Author: Kevin Gao
 *      Co Auth: Wilfred MK
 */

#include "main.h"
#include "display_driver.h"
#include "adxl_driver.h"
#include "HTS221_Driver.h"
#include  "dac_internal_driver.h"
#include "gui_command_modes.h"
#include "u8g2.h"
#include "clock_stopwatch.h"
#include "battery_voltage.h"
#include "light_sensor.h"
#include "rw_flash_driver.h"
#include "volume_images.h"

int testX, timerDim, CH1_DC_Past;

uint8_t pic2[1024]=
{
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0xc0, 0x77, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb0, 0xee, 0x01, 0xf7, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0xb5,
		   0xe3, 0xad, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x5a, 0x57, 0x5f, 0xbb, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0xba, 0xfe, 0xd6, 0x05, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xed, 0xff,
		   0xaa, 0x5d, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x80, 0x5b, 0xeb, 0xbf, 0xea, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xf6, 0x5a, 0xf5, 0xff, 0x0f, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x5d, 0xb7,
		   0x7f, 0xab, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x60, 0x75, 0x6d, 0xea, 0x6e, 0x7b, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xab, 0xfb, 0xff, 0xb5, 0xef, 0x01,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb0, 0x7e, 0xad,
		   0xad, 0xf7, 0xdd, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0xd0, 0xd2, 0xfe, 0xff, 0x7e, 0xff, 0x07, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0xde, 0xfb, 0xe1, 0xef, 0x55, 0x0f,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xbe, 0x75, 0xcf,
		   0x07, 0x3b, 0x1e, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0xab, 0xf6, 0xa3, 0x07, 0x14, 0x3f, 0x18, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x80, 0xfe, 0x5e, 0xf1, 0x0d, 0x08, 0x2f, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xaa, 0x7a, 0xf0,
		   0x0f, 0x80, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x40, 0xf7, 0xed, 0xf0, 0x0f, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x40, 0x55, 0xbb, 0xf1, 0x07, 0x02, 0x3f, 0x08,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xd7, 0xd6, 0xc6,
		   0x03, 0x0f, 0x5f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x40, 0xbd, 0xda, 0xff, 0xf5, 0xfe, 0x7f, 0x03, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0xb0, 0xea, 0x6d, 0x7d, 0xef, 0xab, 0xd6, 0x01,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xab, 0xad, 0xeb,
		   0x7f, 0xfb, 0xba, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x50, 0x5d, 0x7b, 0x5d, 0xb5, 0xad, 0x37, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x50, 0xeb, 0xaa, 0xd5, 0x7e, 0xfb, 0x3e, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x56, 0x77, 0xbb,
		   0xab, 0xd5, 0x6b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0xa8, 0x7d, 0x55, 0x6b, 0xb7, 0x5e, 0xdd, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x68, 0xab, 0xef, 0xde, 0xda, 0x75, 0x6b, 0x01,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0xb6, 0xaa, 0xb5,
		   0x5b, 0xd5, 0xae, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x78, 0x6d, 0xbb, 0x56, 0xed, 0x5b, 0x75, 0x01, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0xd0, 0x6b, 0xeb, 0xfa, 0xad, 0xf6, 0x57, 0x03,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58, 0xdd, 0xb6, 0xaf,
		   0xda, 0x2a, 0xfd, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0xb0, 0xb5, 0xf6, 0xff, 0xb7, 0x6f, 0xcb, 0x07, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0xd8, 0xd6, 0x7d, 0xed, 0x7f, 0xb5, 0xfe, 0x07,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb8, 0x5d, 0xed, 0xbf,
		   0xee, 0xff, 0x7f, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x68, 0xeb, 0xfb, 0xff, 0xff, 0xff, 0xea, 0x01, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x50, 0xad, 0x6e, 0xf5, 0xfb, 0xff, 0xff, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xb6, 0xfb, 0xbf,
		   0xaf, 0xda, 0xdf, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0xa0, 0x6d, 0xb7, 0x77, 0xff, 0x7f, 0xfb, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x60, 0x5b, 0x5d, 0xed, 0xfa, 0xfb, 0x6f, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xd6, 0x7b, 0xdb,
		   0xae, 0xde, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x80, 0xbd, 0xd6, 0x56, 0xdb, 0xb5, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0xd5, 0xba, 0xf5, 0x5a, 0x6d, 0x01, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x57, 0xaf,
		   0xf5, 0x35, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x80, 0xee, 0x5a, 0x57, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xef, 0xee, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		   0x00, 0x99, 0x88, 0x69
};

/* Sends byte of data to the SPI, LCD */
uint8_t byte_cb(u8x8_t *u8x8, uint8_t msg, uint8_t arg_int, void *arg_ptr) {

    switch (msg) {

        case U8X8_MSG_BYTE_INIT:
            /* disable chipselect */
            //HAL_GPIO_WritePin(GPIOB, GPIO_PIN_3, GPIO_PIN_RESET);
            break;

        case U8X8_MSG_BYTE_SEND:
            HAL_SPI_Transmit(&hspi1, (uint8_t *)arg_ptr, arg_int, 0xFFFF);
            break;

        case U8X8_MSG_BYTE_START_TRANSFER:
            //HAL_GPIO_WritePin(GPIOB, GPIO_PIN_3, GPIO_PIN_SET);
            HAL_Delay(1);
            break;

        case U8X8_MSG_BYTE_END_TRANSFER:
            HAL_Delay(1);
            //HAL_GPIO_WritePin(GPIOB, GPIO_PIN_3, GPIO_PIN_RESET);
            break;

        case U8X8_MSG_BYTE_SET_DC:
            break;

        default:
            return 0;
    }
    return 1;
}

/* Creates a delay for the LCD MCU to process parsed data */
uint8_t gpio_and_delay_cb(u8x8_t *u8x8, uint8_t msg, uint8_t arg_int, void *arg_ptr) {

    switch (msg) {

        case U8X8_MSG_GPIO_AND_DELAY_INIT:
            break;

        case U8X8_MSG_DELAY_MILLI:
            HAL_Delay(arg_int);
            break;

        case U8X8_MSG_DELAY_NANO:
            __asm__("nop");
            break;

        default:
            return 0;
    }
    return 1;
}

/* Init PWM Channels and Test the Display Output (Not Needed),
 * Warm-Up Code is used as a reference for the device (Debug Based).
 */
void lcd_init(u8g2_t* u8g2) {

	  /* PWM START */
	  CH1_DC = 0;
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_4);
	  TIM1->CCR4 = CH1_DC;
	  /* PWM END */

	  /* INIT LCD DISPLAY - FULLY BUFFERED*/
	  u8g2_Setup_st7920_s_128x64_f(u8g2, U8G2_R0, byte_cb, gpio_and_delay_cb);
	  u8g2_InitDisplay(u8g2);
	  u8g2_SetPowerSave(u8g2, 0);
	  /* INIT LCD DISPLAY END */


	  //convert_to_64bit_arr(pic2, sizeof(pic2), XBM_FLASH);

}

/* Sets Cradle brightness, and overrides current brightness */
void cradle_brightness_override(void) {

	if ((gYZAngle <= -115 && MODE == 1) || (gXZAngle <= -120 && MODE == 2) || (gYZAngle >= 117 && MODE == 3) || (gXZAngle >= 120 && MODE == 4)) {


		if (!cradleTimerEnable) {
			cradleTimer = HAL_GetTick();
		}

		if (brightLvl != 0 && cradleEnable) {
			brightLvl = 0.15;
		}

		cradleTimerEnable = 1;

	} else {
		cradleTimerEnable = 0;
		cradleEnable = 0;
	}

	if (!cradleEnable && brightLvl == 0) {
		brightLvl = 0.25;
	}

}

/* Will Check the button level and set and appropriate brightness level to match
 * 8 Levels of brightness.
 */
void brighness_control(void)
{
	cradle_brightness_override();

	if(HAL_GetTick() - timerDim > 2) {

		timerDim = HAL_GetTick();

		float level = 65534 * brightLvl / 12;

		if (level < CH1_DC_Past && CH1_DC - 1 >= 0) {

			CH1_DC -= 50;
			TIM1->CCR4 = CH1_DC;

		}

		if (CH1_DC < level && ((CH1_DC + 1) < 65534) ) {

			CH1_DC += 50;
			TIM1->CCR4 = CH1_DC;
			CH1_DC_Past = CH1_DC;

		}
	}
}

/*
 * Updates the LCD Display based on current operational conditions (modes etc..)
 */
void update_LCD(u8g2_t* u8g2) {

	if(LCDStatus == 1){
		/* Welcome Message */
		u8g2_ClearBuffer(u8g2);
		u8g2_DrawXBM(u8g2, 0, 0, 128, 64, pic2);
		u8g2_SendBuffer(u8g2);

	}else{

		  u8g2_ClearBuffer(u8g2);

		  u8g2_SetFontMode(u8g2,1);

		  u8g2_SetFont(u8g2, u8g2_font_profont17_tf);

		  u8g2_DrawFrame(u8g2, 0, 0 , 128 , 64);


		  if (MODE == 1) {

			  /* Stop Watch */
			  u8g2_SetFontDirection(u8g2, 2);

			  u8g2_DrawUTF8(u8g2, 103, 45, "Stopwatch");

			  u8g2_SetFont(u8g2, u8g2_font_profont17_tf);

			  if (startStopWatch == 0) {

				  u8g2_SetFont(u8g2, u8g2_font_profont17_tf);
				  u8g2_DrawUTF8(u8g2, 115, 25, "Tap to Start");

			  } else {

				  u8g2_DrawUTF8(u8g2, 117, 15, stopWatchBuffer);
			  }

			  if (guiConnected) {

				  u8g2_SetFont(u8g2, u8g2_font_micro_mr);
				  u8g2_DrawUTF8(u8g2, 12, 3, "GUI");

			  }
		  }

		  if (MODE == 2) {

			  u8g2_SetFontDirection(u8g2, 1);

			  u8g2_SetFont(u8g2, u8g2_font_open_iconic_weather_4x_t);

			  u8g2_DrawUTF8(u8g2, 90, 17, weatherIcon);

			  u8g2_SetFont(u8g2, u8g2_font_profont15_tf);

			  u8g2_DrawUTF8(u8g2, 70, 10, buffTemp);

			  u8g2_DrawUTF8(u8g2, 50, 5, buffHum);


			  if (guiConnected) {
				  u8g2_SetFont(u8g2, u8g2_font_micro_mr);
				  u8g2_DrawUTF8(u8g2, 3, 50, "GUI");
			  }

		  }

		  if (MODE == 3) {
			  /* Battery Voltage Display Mode */

			  draw_battIcon(u8g2);

			  u8g2_SetFontDirection(u8g2, 0);

			  u8g2_SetFont(u8g2, u8g2_font_profont22_tf);

			  u8g2_DrawUTF8(u8g2, 25, 18, "Battery");


			  u8g2_DrawUTF8(u8g2, 35, 50, batteryBuff);

			  if (guiConnected) {
				  u8g2_SetFont(u8g2, u8g2_font_micro_mr);
				  u8g2_DrawUTF8(u8g2, 115, 60, "GUI");
			  }

		  }

		  if ((MODE == 4 || MODE == 0)  && !(alarmTglScreen)) {
			  /* Clock */
			  if (flashSafeXBM) {
				  u8g2_DrawXBM(u8g2, 0, 0, 128, 64, flashReadXBM);
			  }

			  u8g2_SetFontDirection(u8g2, 3);

			  u8g2_SetFont(u8g2, u8g2_font_profont17_tf);

			  u8g2_DrawUTF8(u8g2, 45, 48, "Time");

			  u8g2_SetFont(u8g2, u8g2_font_profont15_tf);

			  u8g2_DrawUTF8(u8g2, 60, 60, realTimeBuffer);

			  u8g2_DrawUTF8(u8g2, 73, 35, AmPmBuffer);

			  u8g2_SetFont(u8g2, u8g2_font_micro_mr);

			  if (!guiTimeSet) {
				  /* If GUI hasn't set time */
				  if (alarmFlickerEnable) {
					  u8g2_DrawUTF8(u8g2, 10, 33, "Set Time");
				  }
			  }

			  if (alarmRinging == 1) {
				  u8g2_DrawUTF8(u8g2, 10, 45, "!!ALARM!!");
			  }

			  if (alarmSet) {

				  if (!alarm1Set && !alarm2Set && !alarm3Set && !alarm4Set) {
					  u8g2_DrawUTF8(u8g2, 125, 44, "Set Alarms");
				  }

				  if (alarm1Set) {
					  u8g2_DrawUTF8(u8g2, 125, 30, alarm1Buffer);
				  }
				  if (alarm2Set) {
					  u8g2_DrawUTF8(u8g2, 125, 30, alarm2Buffer);
				  }
				  if (alarm3Set) {
					  u8g2_DrawUTF8(u8g2, 125, 30, alarm3Buffer);
				  }
				  if (alarm4Set)
					  u8g2_DrawUTF8(u8g2, 125, 30, alarm4Buffer);
			  } else {
				  u8g2_DrawUTF8(u8g2, 125, 40, "Alarms Off");
			  }

			  if (guiConnected) {

				  u8g2_SetFont(u8g2, u8g2_font_micro_mr);
				  u8g2_DrawUTF8(u8g2, 115, 14, "GUI");

			  }

		  }

		  if (MODE == 5) {

			  draw_volume_image(volNorm , u8g2);

		  }

		 if (MODE == 4 && alarmTglScreen) {

			 adxl_enable = 0;

			 u8g2_SetFontDirection(u8g2, 3);

			 u8g2_DrawUTF8(u8g2, 15, 53, "Alarm");
			 u8g2_DrawUTF8(u8g2, 27, 57, "Select");

			 u8g2_SetFont(u8g2, u8g2_font_profont15_tf);

			 if (button == 1 && alarmFlickerEnable) {
				 u8g2_DrawUTF8(u8g2, 70, 55, alarm1Buffer);
				 alarm1Set = 1;
				 alarm2Set = 0;
				 alarm3Set = 0;
				 alarm4Set = 0;

			 }
			 if (button == 2 && alarmFlickerEnable) {
				 u8g2_DrawUTF8(u8g2, 70, 55, alarm2Buffer);
				 alarm1Set = 0;
				 alarm2Set = 1;
				 alarm3Set = 0;
				 alarm4Set = 0;

			 }
			 if (button == 3 && alarmFlickerEnable) {
				 u8g2_DrawUTF8(u8g2, 70, 55, alarm3Buffer);
				 alarm1Set = 0;
				 alarm2Set = 0;
				 alarm3Set = 1;
				 alarm4Set = 0;

			 }
			 if (button == 4 && alarmFlickerEnable) {
				 u8g2_DrawUTF8(u8g2, 70, 55, alarm4Buffer);
				 alarm1Set = 0;
				 alarm2Set = 0;
				 alarm3Set = 0;
				 alarm4Set = 1;

			 }
		 }

		  u8g2_SendBuffer(u8g2);
	}

}

/* Draw a batter icon, to represent Voltage */
void draw_battIcon(u8g2_t* u8g2) {

	  u8g2_SetFontDirection(u8g2, 3);

	  u8g2_SetFont(u8g2, u8g2_font_battery19_tn);

	  if (voltage >= 4.1) {
		  u8g2_DrawUTF8(u8g2, 72, 30, "5");
	  }

	  if ((voltage >= 3.9 && voltage < 4.1)) {
		  u8g2_DrawUTF8(u8g2, 72, 30, "3");
	  }

	  if ((voltage >= 0 && voltage <= 3.9)) {
		  u8g2_DrawUTF8(u8g2, 72, 30, "1");
	  }

	  u8g2_SetFontDirection(u8g2, 2);

}
